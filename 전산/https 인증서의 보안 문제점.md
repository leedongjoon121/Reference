# https 인증서의 보안 문제점
## [출처] <a href="https://blog.naver.com/PostView.nhn?blogId=kasperskylab2018&logNo=221394248647&parentCategoryNo=&categoryNo=&viewDate=&isShowPopularPosts=false&from=postView">https 인증서의 보안 문제점|작성자 카스퍼스키랩</a> 

## 개요
HTTPS 인증서는 인터넷 보안의 핵심 요소 중 하나지만 HTTPS 인증서를 갖추었다고 해서 항상 보안이 완벽한 것은 아니다. HTTPS의 의미는 한 쌍의 암호 키를 사용해 이용자와 웹사이트 간에 전송되는 정보를 암호화한다는 것이다. 실제로 이러한 이용자의 HTTPS에 대한 신뢰를 악용해 일부 피싱 공격 웹사이트는 HTTPS로 운영되기도 한다.

### 하나의 도메인, 두 개의 인증서
도메인 등록 및 HTTPS 인증서 관리는 담당하는 기관이 서로 다르기 때문에 도메인 및 인증서에 대한 유효 기간이 서로 다른 경우가 있다. 따라서 하나의 도메인에 대해 만료된 이전 소유자와 새로 구매한 현재 소유자가 ‘유효한’ HTTPS 인증서를 동시에 보유하는 상황이 발생하기도 한다.

그런 상황에서는 어떤 피해가 발생할 수 있으며 그러한 문제는 실제로 얼마나 광범위하게 발생하고 있을까? 이에 이안 포스터와 딜런 아이리가 DEF CON 26 컨퍼런스[1]에서 이러한 문제 상황에[2] 대한 연구 결과를 발표했다. 이들의 연구에 따르면 이러한 문제는 보기보다 훨씬 복잡하며 놀랄 만큼 광범위하게 발생하고 있다고 한다.
 
가장 큰 문제는 다른 사람이 자신의 도메인에 대해 유효한 인증서를 보유하고 있을 경우 웹사이트 사용자에 대해 “중간자 공격[3]”
(MiTM)이 발생할 가능성이 있다는 것이다.
 
포스터와 아이리는 인증서 투명성[4] 프로젝트의 인증서 데이터베이스를 사용하여 인증서 교차 소유 문제 상황 150만 건을 찾았다. 이는 전체 인터넷 사이트의 약 0.5%에 해당한다. 그 중 1/4(37만 5천개)은 이전 소유자의 인증서가 여전히 유효하여 37만 5천 개의 도메인이 중간자 공격(MiTM)에 취약한 상태였다.

그러나 문제는 여기에서 그치지 않는다. 수십 개, 수백 개에 이르는 여러 도메인에 대해 하나의 인증서를 생성하는 경우도 매우 빈번하기 때문이다. 예를 들어 포스터와 아이리는 하나의 인증서가 700개의 도메인에 동시에 적용된 사례를 찾아내기도 했다. 여기에는 많은 사람이 즐겨 이용하는 도메인도 여러 개 포함되어 있다고 한다.

700개의 도메인 중 일부는 현재 누구나 소유할 수 있어 당연히 마음만 먹으면 누구나 도메인에 등록하여 HTTPS 인증서를 새로 발급 받을 수 있는 것이다. 이쯤 되면 의문이 생긴다. 새로운 도메인 소유자가 이전 인증서를 해지할 권한을 확보하여 웹사이트를 중간자 공격(MiTM)에서 보호할 수 있을까?

### 인증서는 해지 가능할까?
인증서의 해지 처리는 실제로 가능하다. “인증서에 부정확한 정보나 허위 정보가 표시되는” 경우 인증 센터 운영 절차를[5] 통해 인증서를 해지할 수 있다. 해지 알림이 접수되면 24시간 이내에 해지 처리된다.
 
포스터와 아이리는 이러한 작업의 실제 처리 과정을 살펴보고 해당 절차가 인증 센터에 따라 매우 다양하다는 사실을 알게 되었다. 
Let’s Encrypt 인증 센터는 자동화 방식을 사용하여 인증서 해지가 거의 실시간 수준으로 빠르게 처리되는 편이다. 실제 직원 상담이 필요한 다른 인증 센터의 경우 처리 속도는 상대적으로 느리다. 어떤 경우에는 인내심을 발휘해야 인증서를 해지할 수 있다. 대기 시간이 24시간을 훌쩍 넘기기도 한다. 최악의 경우 인증서 해지에 실패할 수도 있다. 한 예로 Comodo 인증 센터와 인증서 해지에 대한 대화를 나눈 끝에 “이전 사용자의 SSL을 무시하고 새로운 SSL을 주문” 해달라는 안내를 받기도 했다.

그래도 어쨌든 잔류 인증서 해지는 실패하는 경우보다 성공하는 경우가 더 많다. 장점인 동시에 단점이라고 할 수 있다. 일단 새로운 도메인 소유자가 잔류 인증서의 취약점을 이용하는 중간자 공격(MiTM)에서 스스로를 보호할 수 있다는 점에서는 장점이다. 그러나 “공유” 인증서가 적용되는 도메인 중 무료 도메인을 다른 사람이 구매한 다음 해당 인증서를 해지해버리는 경우를 생각해보면 관련 웹사이트 운영을 중단(DoS 공격)할 수 있어 또 다른 문제가 되는 것이다.

이러한 문제는 얼마나 광범위하게 발생하고 있을까? 먼저 살펴본 경우보다 훨씬 더 많은 7백만 개의 도메인, 즉 전체 인터넷의 2%가 넘는 도메인에서 이미 등록 기간이 만료된 도메인과 인증서를 공유하고 있으며 그 중 41%의 인증서가 유효한 것으로 나타났다. 따라서 현재 수백만 개의 도메인이 인증서 해지 취약점을 이용하는 DoS 공격에[6] 노출되어 있다.

앞서 700개의 도메인이 하나의 인증서를 공유하는 사례를 언급했는데, 포스터와 아이리는 이 문제의 시급함을 입증하기 위해 해당 인증서가 적용되는 무료 도메인 중 하나를 구매하는데 성공했다. 즉, 이론적으로는 이들은 수백 개의 현재 운영 중인 웹사이트에 DoS 공격, 즉 기존 웹사이트의 운영을 폐쇄할 수 있는 것이다.

### 보호방법
총 37만 5천 개의 도메인이 중간자 공격(MitM)에 취약하며 그 외 수백만 개의 도메인이 잔류 인증서의 사용을 통한 DoS 공격에 취약하다. 이 글을 읽는 독자 여러분의 도메인 또한 공격을 받을지도 모른다. 대형 해킹 컨퍼런스에도 이러한 내용이 보고된 바 있다. 지금 이 순간에도 누군가는 취약한 도메인을 물색하고 있을 것이다. 그렇다면 웹사이트 소유자가 스스로를 보호하려면 어떻게 해야 할까? 포스터와 아이리는 다음과 같은 조치를 취할 것을 제안한다.

· “강제 적용” 지시를 갖춘 Expect-CT 헤더를 사용하여 도메인에서 인증서 투명성 데이터베이스에 포함된 인증서만 신뢰하도록 설정한다.
· 인증서 투명성 데이터베이스를 사용하여 도메인에 이전 사용자가 발행한 유효한 인증서가 남아 있는지 확인한다. 페이스북의 인증서 투명성 모니터링[7] 도구를 사용하여 이 작업을 수행할 수 있다. 연구원들이 자체적으로[8] 설계한 도구도 있다. 누구나 이 도구를 사용하여 도메인이 앞서 언급한 취약성에 노출되어 있는지 손쉽게 검색할 수 있다.
 
그 밖에 몇 가지 팁도 여기서 소개한다.

· 기업 웹사이트의 전체 인벤토리를 가져와 도메인에 잔류 인증서가 있는지 확인한다. 잔류 인증서가 있을 경우 인증 센터에 연락하여 해당 인증서의 해지를 요청한다.
· 여러 개의 도메인에 대해 하나의 인증서를 받지 않는다. 특히 철저한 운용성 모니터링 과정 없이 수많은 웹사이트와 관련 도메인을 생성하는 것이 기업 내에서 일반적인 관행일 경우에는 더욱 주의해야 한다. 그런 “중단” 도메인에 대한 등록 기간이 만료되었는데 엉뚱한 사람이 도메인을 손에 넣고 이를 해지하면 기업 웹사이트가 너무나 쉽게 중단될 수 있다.
· 사전에 인증서 손상 상황을 고려하여 대비한다. 그러한 인증서는 시급히 해지해야 한다. 연구에 따르면 일부 인증 센터는 대응이 너무 느리므로 대응 속도가 빠른 인증 센터를 이용하는 것이 좋다.

#### 참조 링크
- [1] Kaspersky Lab. 2018.https://www.kaspersky.com/blog/tag/def-con/ 
- [2] Foster, I. and Ayrey, D. 2018. https://insecure.design/ 
- [3] Kaspersky Lab Encyclopedia. 2018. https://encyclopedia.kaspersky.com/glossary/man-in-the-middle-attack/?utm_source=kdaily&utm_medium=blog&utm_campaign=termin-explanation 
- [4] Certificate Transparency. 2018. https://www.certificate-transparency.org/ 
- [5] CA/Browser Forum. 2018. https://cabforum.org/wp-content/uploads/CA-Browser-Forum-BR-1.5.7-29-Apr-2018.pdf 
- [6] Kaspersky Lab Encyclopedia. 2018. https://encyclopedia.kaspersky.com/glossary/dos-denial-of-service-attack/?utm_source=kdaily&utm_medium=blog&utm_campaign=termin-explanation 
- [7] Facebook for Developers. n.d. https://developers.facebook.com/tools/ct/ 
- [8] Ayrey, D. 2018. https://github.com/dxa4481/bygonessl



