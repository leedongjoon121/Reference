# 웹 브라우저의 HTML 문서 렌더링 과정
## <a href="https://d2.naver.com/helloworld/59361">참조1</a>
## <a href="http://jeong-pro.tistory.com/90?category=793347">참조2</a>

<hr/>

## 요약 

### 1. 불러오기
- 로더(Loader)가 서버로부터 전달 받는 리소스 스트림을 읽는 과정, 읽으면서 어떤 파일인지, 데이터인지 파일을 다운로드할 것인지 등을 결정

### 2. 파싱
- 웹 엔진이 가지고 있는 HTML/XML 파서가 문서를 파싱해서 DOM Tree를 만든다.

### 3. 렌더링 트리 만들기
- Dom Tree는 내용을 저장하는 트리로, 자바스크립트에서 접근하는 DOM객체를 쓸 때 이용하는 것이고, 별도로 그리기 위한 트리가 만들어져야 하는데 그것이 렌더링 트리다. (그릴 때 필요없는 head, title, body 태그등이 없음 + display:none 처럼 DOM에는 있지만 화면에서는 걸러내야할 것들을 걸러냄)

### 4. CSS 결정
- CSS는 선택자에 따라서 적용되는 태그가 다르기 때문에 모든 CSS 스타일을 분석해 태그에 스타일 규칙이 적용되게 결정한다.

### 5. 레이아웃
- 렌더링 트리에서 위치나 크기를 가지고 있지 않기 때문에 객체들에게 위치와 크기를 정해주는 과정

### 6. 그리기
- 렌더링 트리를 탐색하면서 그리기

<hr/>

## Head에서 CSS는 위에 Script는 아래에 ?

문서를 파싱해서 DOM Tree를 만들어도 스타일 규칙이 없으면 렌더링을 할 수가 없다.
즉, 최대한 빨리 스타일 규칙을 알아야 렌더링트리가 완전히 만들어지므로 스타일시트 파일을 모두 다운로드시키기 위해 <head></head>태그 사이에 놓는 것이다. (인터프리터에서 html파일 위에서 아래로 읽음)

자바스크립트는 왜 아래에 놓아야 성능이 좋아질 까 ?

자바스크립트는 DOM객체를 이용해서 컴포넌트들을 조작하는데, <head></head>태그 사이 처럼 상단에 놓게되면 HTML파서가 파싱을 멈추고 스크립트파일을 읽기 때문

파싱을 멈추고 읽기 때문에 위에서 스크립트파일이 많거나, 파일이 크면 읽는 시간이 오래걸려 사용자 입장에서 웹페이지가 느리게 보이게 되므로 느리다고 느낄 수 있다.

심지어 잘못 코딩했을 경우 HTML 파싱보다 자바스크립트 파일이 먼저 실행되어 적용이 안되는 모습도 볼 수있다.



## Jquery Document.ready(), Window.load() 실행 

$(documnet).ready() : 외부 리소스, 이미지와 상관없이 DOM Tree 생성 후 실행됨 

$(window).load() : 화면에 필요한 모든 요소들이 메모리에 모두 올려진 다음에 실행됨 (=화면이 모두 그려진 다음)

=> 즉 $(document).ready()가 DOM Tree가 만들어진 후에 바로 실행되므로 $(window).load()보다 먼저 실행 된다.


$(window).load()를 사용할 때 주의사항

- body의 onload 이벤트를 적용할 시 $(window).load()가 실행되지 않을 수 있음.
- 외부 링크나 파일 include시, 안에 $(window).load()가 있으면 둘중에 하나만 실행됨.
- 웹페이지에 많은 이미지가 존재해서 이미지가 로딩되는데 오래걸리면 그것들이 로딩될 때까지 $(window).load()는 딜레이됨

<hr/>

## 심화 : 브라우저 렌더링

### 브라우저의 기본구조

#### 1. 사용자 인터페이스 : 주소 표시줄, 이전/다음 버튼, 북마크 메뉴 등 요청한 페이지를 보여주는 창을 제외한 나머지 모든 부분
#### 2. 브라우저 엔진 : 사용자 인터페이스와 렌더링 엔진 사이의 동작을 제어
#### 3. 렌더링 엔진 : 요청한 콘텐츠를 표시, 예를들어 HTML을 요청하면 HTML과 CSS를 파싱하여 화면에 표시함
#### 4. 통신 : HTTP 요청과 같은 네트워크 호출에 사용됨, 이것은 플랫폼 독립적인 인터페이스이고 각 플랫폼 하부에서 실행됨
#### 5. UI 백엔드 : 콤보박스와 창 같은 기본적인 장치를 그림, 플랫폼에서 명시하지 않은 일반적인 인터페이스로서, OS 사용자 인터페이스 체계를 사용
#### 6. 자바스크립트 해석기 : 자바스크립트 코드를 해석하고 실행
#### 7. 자료 저장소 : 자료를 저장하는 계층, 쿠키를 저장하는 것과 같이 모든 종류의 자원을 하드 디스크에 저장할 필요가 있다. HTML5 명세에는 브라우저가 지원하는 '웹 데이터 베이스'가 정의되어 있다.

## ![사진](https://github.com/leedongjoon121/Reference/blob/img/img/%EB%B8%8C%EB%9D%BC%EC%9A%B0%EC%A0%80%EA%B5%AC%EC%84%B1%EC%9A%94%EC%86%8C.PNG?raw=true)

크롬은 대부분의 브라우저와 달리, 각 탭마다 별도의 렌더링 엔진 인스턴스를 유지하는 것이 주목할 만하다. 각 탭은 독립된 프로세스로 처리된다.

### 렌더링 엔진

렌더링 엔진의 역할은 요청 받은 내용을 브라우저 화면에 표시하는 일

렌더링 엔진은 HTML 및 XML 문서와 이미지를 표시할 수 있다. 물론 플러그인이나 브라우저 확장 기능을 이용해 PDF와 같은 다른 유형도 표시할 수 있다.

### 렌더링 엔진 종류
- 크롬 / 사파리 : 웹킷(Webkit) 엔진을 사용
- 파이어폭스 : 게코(Gecko) 엔진을 사용

### 동작과정

렌더링 엔진은 통신으로부터 요청한 문서의 내용을 얻는 것으로 시작하는데, 문서의 내용은 보통 8KB 단위로 전송

## ![사진](https://github.com/leedongjoon121/Reference/blob/img/img/%EB%A0%8C%EB%8D%94%EB%A7%81%EB%8F%99%EC%9E%91%EA%B3%BC%EC%A0%95.PNG?raw=true)

렌더링 엔진은 HTML 문서를 파싱하고 "콘텐츠 트리" 내부에서 태그를 DOM 노드로 변환한다. 그 다음 외부 CSS 파일과 함께 포함된 스타일 요소도 파싱한다. 스타일 정보와 HTML 표시 규칙은 "렌더 트리"라고 부르는 또 다른 트리를 생성한다.

렌더 트리는 색상 또는 면적과 같은 시각적 속성이 있는 사각형을 포함하고 있는데 정해진 순서대로 화면에 표시된다.

렌더 트리 생성이 끝나면 배치가 시작되는데 이것은 각 노드가 화면의 정확한 위치에 표시되는 것을 의미한다. 다음은 UI 백엔드에서 렌더 트리의 각 노드를 가로지르며 형상을 만들어 내는 그리기 과정이다.

일련의 과정들이 점진적으로 진행된다는 것을 아는 것이 중요하다. 렌더링 엔진은 좀 더 나은 사용자 경험을 위해 가능하면 빠르게 내용을 표시하는데 모든 HTML을 파싱할 때까지 기다리지 않고 배치와 그리기 과정을 시작한다. 네트워크로부터 나머지 내용이 전송되기를 기다리는 동시에 받은 내용의 일부를 먼저 화면에 표시하는 것이다.

### 동작과정 예

## ![사진](https://github.com/leedongjoon121/Reference/blob/img/img/%EB%A0%8C%EB%8D%94%EB%A7%81%EC%97%94%EC%A7%84.PNG?raw=true)

### DOM

DOM은 문서 객체 모델(Document Object Model)의 준말이다. 이것은 HTML 문서의 객체 표현이고 외부를 향하는 자바스크립트와 같은 HTML 요소의 연결 지점이다. 트리의 최상위 객체는 문서이다.

DOM은 마크업과 1:1의 관계를 맺는다. 예를 들면 이런 마크업이 있다.

```swift
 <html>
  <body>
   <p>Hello World</p>
   <div><img src="example.png" /></div>
  </body>
</html>  

```

이것은 아래와 같은 DOM 트리로 변환 될 수 있다.

## ![사진](https://github.com/leedongjoon121/Reference/blob/img/img/html%EB%A7%88%ED%81%AC%EC%97%85.PNG?raw=true)

HTML과 마찬가지로 DOM은 W3C에 의해 명세(www.w3.org/DOM/DOMTR)가 정해져 있다. 이것은 문서를 다루기 위한 일반적인 명세인데 부분적으로 HTML 요소를 설명하기도 한다. HTML 정의는 www.w3.org/TR/2003/REC-DOM-Level-2-HTML-20030109/idl-definitions.html에서 찾을 수 있다.

트리가 DOM 노드를 포함한다고 말하는 것은 DOM 접점의 하나를 실행하는 요소를 구성한다는 의미다. 브라우저는 내부의 다른 속성들을 이용하여 이를 구체적으로 실행한다.
